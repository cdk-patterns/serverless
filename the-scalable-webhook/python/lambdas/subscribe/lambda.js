"use strict";
const { DynamoDB } = require('aws-sdk');
exports.handler = async function (event) {
    console.log("request:", JSON.stringify(event, undefined, 2));
    let records = event.Records;
    // create AWS SDK clients
    const dynamo = new DynamoDB();
    for (let index in records) {
        let payload = records[index].body;
        let id = records[index].messageAttributes.MessageDeduplicationId.stringValue;
        console.log('received message ' + payload);
        var params = {
            TableName: process.env.tableName,
            Item: {
                'id': { S: id },
                'message': { S: payload }
            }
        };
        // Call DynamoDB to add the item to the table
        await dynamo.putItem(params, function (err, data) {
            if (err) {
                console.log("Error", err);
            }
            else {
                console.log("Success", data);
            }
        }).promise();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFtYmRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGFtYmRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRXhDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxXQUFVLEtBQVM7SUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFN0QsSUFBSSxPQUFPLEdBQVUsS0FBSyxDQUFDLE9BQU8sQ0FBQztJQUNuQyx5QkFBeUI7SUFDekIsTUFBTSxNQUFNLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztJQUU5QixLQUFJLElBQUksS0FBSyxJQUFJLE9BQU8sRUFBRTtRQUN4QixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ2xDLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBc0IsQ0FBQyxXQUFXLENBQUE7UUFDNUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsR0FBRyxPQUFPLENBQUMsQ0FBQztRQUczQyxJQUFJLE1BQU0sR0FBRztZQUNYLFNBQVMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVM7WUFDaEMsSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRyxFQUFDLENBQUMsRUFBRSxFQUFFLEVBQUM7Z0JBQ2QsU0FBUyxFQUFHLEVBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBQzthQUN6QjtTQUNGLENBQUM7UUFFRiw2Q0FBNkM7UUFDN0MsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxVQUFTLEdBQU8sRUFBRSxJQUFRO1lBQ3JELElBQUksR0FBRyxFQUFFO2dCQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQzNCO2lCQUFNO2dCQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQzlCO1FBQ0gsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDZDtBQUNILENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgRHluYW1vREIgfSA9IHJlcXVpcmUoJ2F3cy1zZGsnKTtcclxuXHJcbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIGZ1bmN0aW9uKGV2ZW50OmFueSkge1xyXG4gIGNvbnNvbGUubG9nKFwicmVxdWVzdDpcIiwgSlNPTi5zdHJpbmdpZnkoZXZlbnQsIHVuZGVmaW5lZCwgMikpO1xyXG5cclxuICBsZXQgcmVjb3JkczogYW55W10gPSBldmVudC5SZWNvcmRzO1xyXG4gIC8vIGNyZWF0ZSBBV1MgU0RLIGNsaWVudHNcclxuICBjb25zdCBkeW5hbW8gPSBuZXcgRHluYW1vREIoKTtcclxuICBcclxuICBmb3IobGV0IGluZGV4IGluIHJlY29yZHMpIHtcclxuICAgIGxldCBwYXlsb2FkID0gcmVjb3Jkc1tpbmRleF0uYm9keTtcclxuICAgIGxldCBpZCA9IHJlY29yZHNbaW5kZXhdLm1lc3NhZ2VBdHRyaWJ1dGVzLk1lc3NhZ2VEZWR1cGxpY2F0aW9uSWQuc3RyaW5nVmFsdWVcclxuICAgIGNvbnNvbGUubG9nKCdyZWNlaXZlZCBtZXNzYWdlICcgKyBwYXlsb2FkKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LnRhYmxlTmFtZSxcclxuICAgICAgSXRlbToge1xyXG4gICAgICAgICdpZCcgOiB7UzogaWR9LFxyXG4gICAgICAgICdtZXNzYWdlJyA6IHtTOiBwYXlsb2FkfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBDYWxsIER5bmFtb0RCIHRvIGFkZCB0aGUgaXRlbSB0byB0aGUgdGFibGVcclxuICAgIGF3YWl0IGR5bmFtby5wdXRJdGVtKHBhcmFtcywgZnVuY3Rpb24oZXJyOmFueSwgZGF0YTphbnkpIHtcclxuICAgICAgaWYgKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3JcIiwgZXJyKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlN1Y2Nlc3NcIiwgZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH0pLnByb21pc2UoKTtcclxuICB9XHJcbn07Il19