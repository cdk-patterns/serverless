"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const aws_entities_1 = require("../build-tools/aws-entities");
const lib_1 = require("../lib");
describe('find', () => {
    test('returns undefined for an unknown fact', () => {
        expect(lib_1.Fact.find(aws_entities_1.AWS_REGIONS[0], 'not:a:known:fact')).toBe(undefined);
    });
    test('returns undefined for an unknown region', () => {
        expect(lib_1.Fact.find('bermuda-triangle-42', lib_1.FactName.PARTITION)).toBe(undefined);
    });
});
describe('requireFact', () => {
    test('throws error for an unknown fact', () => {
        expect(() => lib_1.Fact.requireFact(aws_entities_1.AWS_REGIONS[0], 'not:a:known:fact')).toThrowError();
    });
    test('throws error for an unknown region', () => {
        expect(() => lib_1.Fact.requireFact('bermuda-triangle-42', lib_1.FactName.PARTITION)).toThrowError();
    });
});
describe('register', () => {
    test('allows registering an arbitrary fact', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        // THEN
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
    test('allows re-registering a fact with the same value', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
    test('disallows re-registering a fact with a different value', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = lib_1.FactName.PARTITION;
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).not.toBe(value);
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value }))
            .toThrowError(/already has a fact/);
    });
    test('allows overriding an arbitrary fact', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value: 'Foo' }, true)).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe('Foo');
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjdC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmFjdC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOERBQTBEO0FBQzFELGdDQUF3QztBQUV4QyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1FBQ2pELE1BQU0sQ0FBQyxVQUFJLENBQUMsSUFBSSxDQUFDLDBCQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4RSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDbkQsTUFBTSxDQUFDLFVBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsY0FBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQy9FLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQzVDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxVQUFJLENBQUMsV0FBVyxDQUFDLDBCQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3BGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtRQUM5QyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBSSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsRUFBRSxjQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMzRixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FB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TUFBTSxHQUFHLDBCQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxJQUFJLEdBQUcsZ0JBQWdCLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBRXJCLE9BQU87UUFDUCxNQUFNLENBQUMsVUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDeEUsTUFBTSxDQUFDLFVBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTVDLE9BQU87UUFDUCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JGLE1BQU0sQ0FBQyxVQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU1QyxVQUFVO1FBQ1YsVUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFXU19SRUdJT05TIH0gZnJvbSAnLi4vYnVpbGQtdG9vbHMvYXdzLWVudGl0aWVzJztcbmltcG9ydCB7IEZhY3QsIEZhY3ROYW1lIH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ2ZpbmQnLCAoKSA9PiB7XG4gIHRlc3QoJ3JldHVybnMgdW5kZWZpbmVkIGZvciBhbiB1bmtub3duIGZhY3QnLCAoKSA9PiB7XG4gICAgZXhwZWN0KEZhY3QuZmluZChBV1NfUkVHSU9OU1swXSwgJ25vdDphOmtub3duOmZhY3QnKSkudG9CZSh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdyZXR1cm5zIHVuZGVmaW5lZCBmb3IgYW4gdW5rbm93biByZWdpb24nLCAoKSA9PiB7XG4gICAgZXhwZWN0KEZhY3QuZmluZCgnYmVybXVkYS10cmlhbmdsZS00MicsIEZhY3ROYW1lLlBBUlRJVElPTikpLnRvQmUodW5kZWZpbmVkKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3JlcXVpcmVGYWN0JywgKCkgPT4ge1xuICB0ZXN0KCd0aHJvd3MgZXJyb3IgZm9yIGFuIHVua25vd24gZmFjdCcsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZXF1aXJlRmFjdChBV1NfUkVHSU9OU1swXSwgJ25vdDphOmtub3duOmZhY3QnKSkudG9UaHJvd0Vycm9yKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBlcnJvciBmb3IgYW4gdW5rbm93biByZWdpb24nLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVxdWlyZUZhY3QoJ2Jlcm11ZGEtdHJpYW5nbGUtNDInLCBGYWN0TmFtZS5QQVJUSVRJT04pKS50b1Rocm93RXJyb3IoKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3JlZ2lzdGVyJywgKCkgPT4ge1xuICB0ZXN0KCdhbGxvd3MgcmVnaXN0ZXJpbmcgYW4gYXJiaXRyYXJ5IGZhY3QnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCByZWdpb24gPSBBV1NfUkVHSU9OU1swXTtcbiAgICBjb25zdCBuYW1lID0gJ215OmN1c3RvbTpmYWN0JztcbiAgICBjb25zdCB2YWx1ZSA9ICcxMzM3JztcblxuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodW5kZWZpbmVkKTtcbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZWdpc3Rlcih7IHJlZ2lvbiwgbmFtZSwgdmFsdWUgfSkpLm5vdC50b1Rocm93RXJyb3IoKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodmFsdWUpO1xuXG4gICAgLy8gQ2xlYW51cFxuICAgIEZhY3QudW5yZWdpc3RlcihyZWdpb24sIG5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCdhbGxvd3MgcmUtcmVnaXN0ZXJpbmcgYSBmYWN0IHdpdGggdGhlIHNhbWUgdmFsdWUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCByZWdpb24gPSBBV1NfUkVHSU9OU1swXTtcbiAgICBjb25zdCBuYW1lID0gJ215OmN1c3RvbTpmYWN0JztcbiAgICBjb25zdCB2YWx1ZSA9ICcxMzM3JztcblxuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodW5kZWZpbmVkKTtcbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZWdpc3Rlcih7IHJlZ2lvbiwgbmFtZSwgdmFsdWUgfSkpLm5vdC50b1Rocm93RXJyb3IoKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZWdpc3Rlcih7IHJlZ2lvbiwgbmFtZSwgdmFsdWUgfSkpLm5vdC50b1Rocm93RXJyb3IoKTtcbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodmFsdWUpO1xuXG4gICAgLy8gQ2xlYW51cFxuICAgIEZhY3QudW5yZWdpc3RlcihyZWdpb24sIG5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCdkaXNhbGxvd3MgcmUtcmVnaXN0ZXJpbmcgYSBmYWN0IHdpdGggYSBkaWZmZXJlbnQgdmFsdWUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCByZWdpb24gPSBBV1NfUkVHSU9OU1swXTtcbiAgICBjb25zdCBuYW1lID0gRmFjdE5hbWUuUEFSVElUSU9OO1xuICAgIGNvbnN0IHZhbHVlID0gJzEzMzcnO1xuXG4gICAgLy8gV0hFTlxuICAgIGV4cGVjdChGYWN0LmZpbmQocmVnaW9uLCBuYW1lKSkubm90LnRvQmUodmFsdWUpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBGYWN0LnJlZ2lzdGVyKHsgcmVnaW9uLCBuYW1lLCB2YWx1ZSB9KSlcbiAgICAgIC50b1Rocm93RXJyb3IoL2FscmVhZHkgaGFzIGEgZmFjdC8pO1xuICB9KTtcblxuICB0ZXN0KCdhbGxvd3Mgb3ZlcnJpZGluZyBhbiBhcmJpdHJhcnkgZmFjdCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHJlZ2lvbiA9IEFXU19SRUdJT05TWzBdO1xuICAgIGNvbnN0IG5hbWUgPSAnbXk6Y3VzdG9tOmZhY3QnO1xuICAgIGNvbnN0IHZhbHVlID0gJzEzMzcnO1xuXG4gICAgLy8gV0hFTlxuICAgIGV4cGVjdChGYWN0LmZpbmQocmVnaW9uLCBuYW1lKSkudG9CZSh1bmRlZmluZWQpO1xuICAgIGV4cGVjdCgoKSA9PiBGYWN0LnJlZ2lzdGVyKHsgcmVnaW9uLCBuYW1lLCB2YWx1ZSB9KSkubm90LnRvVGhyb3dFcnJvcigpO1xuICAgIGV4cGVjdChGYWN0LmZpbmQocmVnaW9uLCBuYW1lKSkudG9CZSh2YWx1ZSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVnaXN0ZXIoeyByZWdpb24sIG5hbWUsIHZhbHVlOiAnRm9vJyB9LCB0cnVlKSkubm90LnRvVGhyb3dFcnJvcigpO1xuICAgIGV4cGVjdChGYWN0LmZpbmQocmVnaW9uLCBuYW1lKSkudG9CZSgnRm9vJyk7XG5cbiAgICAvLyBDbGVhbnVwXG4gICAgRmFjdC51bnJlZ2lzdGVyKHJlZ2lvbiwgbmFtZSk7XG4gIH0pO1xufSk7XG4iXX0=